{% extends "layout.html" %}
{% block title %}Select Caterering{% endblock %}
{% block content %}
<div class="row">
  <div class="col-xs-12 col-sm-6 col-sm-offset-3 col-md-6 col-md-offset-3">
    <h2>Select Caterering</h2>
    
    <table class="table table-hover table-condensed table-responsive table-striped">
      <thead>
        <tr>
          <th>Dish Name</th>
          <th>Caterer</th>
          <th>Quantity</th>
          <th>Price</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        {% for dish in dishes %}
        <tr>
          <td>{{dish.name}}</td>
          <td>{{dish.caterer.name}}</td>
          <td><input type="number" min="0" class="update-trigger" name="{{dish.id}}" value="0" data-price="{{dish.price|round(2)}}"/></td>
          <td>${{dish.price|round(2)}}</td>
          <td><p id="{{dish.id}}Total">$0</p></td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr class="info">
          <th colspan="4">Total</th>
          <th id="finalTotal">$0</th>
        </tr>
      </tfoot>
    </table>
    
  </div>
</div>
{% endblock %}
{% block script %}
<script>
  var cateringTotal = 0;
  $('.update-trigger').on('input propertychange paste', function(e){
    updateTotals();
  })

  function updateTotals(){
    cateringTotal = 0;
    $('.update-trigger').each(function(e){
      var total = this.dataset['price'] * this.value;
      cateringTotal += total;
      $("#"+this.name+"Total").html("$" + total.toFixed(2));
    })
    $("#finalTotal").html("$" + cateringTotal.toFixed(2)); 
  }
  updateTotals();
</script>
{% endblock %}
